<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAC Terminal — Sign In</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg-primary:  #0a0a0f;
    --bg-card:     #12121a;
    --bg-elevated: #1a1a26;
    --border:      rgba(255,255,255,0.06);
    --border-hover:rgba(255,255,255,0.12);
    --green:       #00D775;
    --green-dim:   rgba(0,215,117,0.12);
    --green-glow:  rgba(0,215,117,0.25);
    --text-primary:  #f0f0f8;
    --text-secondary:#a0a0b8;
    --text-muted:    #5a5a78;
    --red:         #EF4444;
    --red-dim:     rgba(239,68,68,0.1);
    --font-ui:     'Plus Jakarta Sans', sans-serif;
    --font-mono:   'JetBrains Mono', monospace;
  }

  html, body {
    height: 100%;
    background: var(--bg-primary);
    font-family: var(--font-ui);
    color: var(--text-primary);
  }

  /* ── Page layout ── */
  .page {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 24px;
    background:
      radial-gradient(ellipse 60% 40% at 50% -10%, rgba(0,215,117,0.06) 0%, transparent 70%),
      var(--bg-primary);
  }

  /* ── Card ── */
  .card {
    width: 100%;
    max-width: 420px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 40px 36px;
  }

  /* ── Branding ── */
  .brand {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 28px;
    justify-content: center;
  }

  .logo-box {
    width: 40px;
    height: 40px;
    background: var(--green-dim);
    border: 1px solid rgba(0,215,117,0.25);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-mono);
    font-size: 14px;
    font-weight: 700;
    color: var(--green);
    letter-spacing: -0.5px;
  }

  .brand-text .name {
    font-size: 17px;
    font-weight: 800;
    color: var(--text-primary);
    letter-spacing: -0.3px;
    line-height: 1.1;
  }

  .brand-text .sub {
    font-size: 10px;
    color: var(--text-muted);
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    margin-top: 2px;
  }

  /* ── Title ── */
  .card-title {
    font-size: 20px;
    font-weight: 800;
    color: var(--text-primary);
    text-align: center;
    margin-bottom: 6px;
    letter-spacing: -0.3px;
  }

  .card-sub {
    font-size: 12px;
    color: var(--text-muted);
    text-align: center;
    margin-bottom: 28px;
    line-height: 1.5;
  }

  /* ── Google button ── */
  .btn-google {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    background: var(--bg-elevated);
    border: 1px solid var(--border-hover);
    border-radius: 10px;
    padding: 13px 16px;
    font-family: var(--font-ui);
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
    cursor: pointer;
    transition: border-color 0.15s, background 0.15s;
    text-decoration: none;
  }

  .btn-google:hover {
    border-color: rgba(255,255,255,0.2);
    background: #1e1e2e;
  }

  .btn-google svg {
    flex-shrink: 0;
  }

  /* ── Divider ── */
  .divider {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 22px 0;
    color: var(--text-muted);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.08em;
  }

  .divider::before, .divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* ── Form ── */
  .form-field {
    margin-bottom: 14px;
  }

  .form-field label {
    display: block;
    font-size: 10px;
    font-weight: 700;
    color: var(--text-muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 6px;
  }

  .form-field input {
    width: 100%;
    background: var(--bg-primary);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 11px 14px;
    font-family: var(--font-mono);
    font-size: 13px;
    color: var(--text-primary);
    outline: none;
    transition: border-color 0.15s;
  }

  .form-field input:focus {
    border-color: rgba(0,215,117,0.4);
  }

  .form-field input::placeholder {
    color: var(--text-muted);
  }

  /* ── Primary button ── */
  .btn-primary {
    width: 100%;
    background: var(--green);
    border: none;
    border-radius: 10px;
    padding: 13px 16px;
    font-family: var(--font-ui);
    font-size: 14px;
    font-weight: 800;
    color: #05150d;
    cursor: pointer;
    letter-spacing: 0.02em;
    margin-top: 6px;
    transition: opacity 0.15s, transform 0.1s;
  }

  .btn-primary:hover { opacity: 0.9; }
  .btn-primary:active { transform: scale(0.99); }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

  /* ── Mode toggle ── */
  .toggle-row {
    text-align: center;
    margin-top: 20px;
    font-size: 12px;
    color: var(--text-muted);
  }

  .toggle-row button {
    background: none;
    border: none;
    color: var(--green);
    font-family: var(--font-ui);
    font-size: 12px;
    font-weight: 700;
    cursor: pointer;
    padding: 0;
    margin-left: 4px;
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  /* ── Error / success message ── */
  .msg {
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
    line-height: 1.5;
    margin-bottom: 14px;
    display: none;
  }

  .msg.error {
    background: var(--red-dim);
    border: 1px solid rgba(239,68,68,0.25);
    color: #f87171;
  }

  .msg.success {
    background: var(--green-dim);
    border: 1px solid rgba(0,215,117,0.25);
    color: var(--green);
  }

  /* ── Footer ── */
  .card-footer {
    text-align: center;
    margin-top: 28px;
    font-size: 10px;
    color: var(--text-muted);
    line-height: 1.6;
  }
</style>
</head>
<body>

<div class="page">
  <div class="card">

    <!-- Branding -->
    <div class="brand">
      <div class="logo-box">MAC</div>
      <div class="brand-text">
        <div class="name">MAC Terminal</div>
        <div class="sub">Market Action Center</div>
      </div>
    </div>

    <!-- Heading (changes by mode) -->
    <div class="card-title" id="card-title">Welcome back</div>
    <div class="card-sub" id="card-sub">Sign in to access your trading dashboard</div>

    <!-- Inline message -->
    <div class="msg" id="msg"></div>

    <!-- Google OAuth -->
    <button class="btn-google" id="btn-google" onclick="signInWithGoogle()">
      <!-- Google "G" icon -->
      <svg width="18" height="18" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.08 17.74 9.5 24 9.5z"/>
        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.36-8.16 2.36-6.26 0-11.57-3.59-13.46-8.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
        <path fill="none" d="M0 0h48v48H0z"/>
      </svg>
      Sign in with Google
    </button>

    <div class="divider">— OR —</div>

    <!-- Email/password form -->
    <form id="auth-form" onsubmit="submitForm(event)" novalidate>
      <div class="form-field">
        <label for="email-input">Email</label>
        <input id="email-input" type="email" placeholder="you@example.com" autocomplete="email" required>
      </div>
      <div class="form-field">
        <label for="password-input">Password</label>
        <input id="password-input" type="password" placeholder="••••••••" autocomplete="current-password" required>
      </div>
      <button class="btn-primary" id="btn-submit" type="submit">Sign In</button>
    </form>

    <div class="toggle-row">
      <span id="toggle-text">Don't have an account?</span>
      <button id="toggle-btn" onclick="toggleMode()">Create one</button>
    </div>

    <div class="card-footer">
      Your credentials are secured by Supabase and never stored locally.
    </div>

  </div>
</div>

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = 'https://urpblscayyeadecozgvo.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_83TVqX2bbCJnXMlW6rGP0A_yu_9o77w';
  const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  let mode = 'signin'; // 'signin' | 'signup'

  // ── If already logged in, go straight to the app ──────────
  (async function() {
    const { data: { session } } = await _supabase.auth.getSession();
    if (session) {
      window.location.replace('/app/');
    }
  })();

  // Also handle the OAuth redirect callback (hash fragment)
  _supabase.auth.onAuthStateChange((event, session) => {
    if (session) {
      window.location.replace('/app/');
    }
  });

  // ── UI helpers ─────────────────────────────────────────────
  function showMsg(text, type = 'error') {
    const el = document.getElementById('msg');
    el.textContent = text;
    el.className = 'msg ' + type;
    el.style.display = 'block';
  }

  function clearMsg() {
    const el = document.getElementById('msg');
    el.style.display = 'none';
    el.textContent = '';
  }

  function setLoading(loading) {
    document.getElementById('btn-submit').disabled = loading;
    document.getElementById('btn-google').disabled = loading;
    document.getElementById('btn-submit').textContent =
      loading ? 'Please wait…' : (mode === 'signin' ? 'Sign In' : 'Create Account');
  }

  // ── Toggle sign-in / sign-up mode ─────────────────────────
  function toggleMode() {
    clearMsg();
    mode = mode === 'signin' ? 'signup' : 'signin';

    const isSignIn = mode === 'signin';

    document.getElementById('card-title').textContent = isSignIn ? 'Welcome back' : 'Create account';
    document.getElementById('card-sub').textContent = isSignIn
      ? 'Sign in to access your trading dashboard'
      : 'Set up your MAC Terminal account';
    document.getElementById('btn-submit').textContent = isSignIn ? 'Sign In' : 'Create Account';
    document.getElementById('toggle-text').textContent = isSignIn ? "Don't have an account?" : 'Already have an account?';
    document.getElementById('toggle-btn').textContent = isSignIn ? 'Create one' : 'Sign in';

    const pwInput = document.getElementById('password-input');
    pwInput.autocomplete = isSignIn ? 'current-password' : 'new-password';
  }

  // ── Google OAuth ───────────────────────────────────────────
  async function signInWithGoogle() {
    clearMsg();
    setLoading(true);
    const { error } = await _supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: window.location.origin + '/app/'
      }
    });
    if (error) {
      showMsg(error.message);
      setLoading(false);
    }
    // If no error, browser will redirect to Google — no need to re-enable
  }

  // ── Email / password submit ────────────────────────────────
  async function submitForm(e) {
    e.preventDefault();
    clearMsg();

    const email    = document.getElementById('email-input').value.trim();
    const password = document.getElementById('password-input').value;

    if (!email || !password) {
      showMsg('Please enter your email and password.');
      return;
    }

    setLoading(true);

    if (mode === 'signin') {
      const { error } = await _supabase.auth.signInWithPassword({ email, password });
      if (error) {
        showMsg(friendlyError(error));
        setLoading(false);
      }
      // onAuthStateChange handles the redirect on success

    } else {
      const { error } = await _supabase.auth.signUp({ email, password });
      if (error) {
        showMsg(friendlyError(error));
        setLoading(false);
      } else {
        showMsg('Account created! Check your email for a confirmation link before signing in.', 'success');
        setLoading(false);
        // Switch back to sign-in mode after signup
        if (mode !== 'signin') toggleMode();
      }
    }
  }

  // ── Humanize Supabase error messages ──────────────────────
  function friendlyError(error) {
    const msg = (error.message || '').toLowerCase();
    if (msg.includes('invalid login credentials') || msg.includes('invalid email or password')) {
      return 'Incorrect email or password. Please try again.';
    }
    if (msg.includes('email not confirmed')) {
      return 'Please confirm your email address before signing in.';
    }
    if (msg.includes('user already registered')) {
      return 'An account with that email already exists. Try signing in.';
    }
    if (msg.includes('password should be at least')) {
      return 'Password must be at least 6 characters.';
    }
    if (msg.includes('rate limit')) {
      return 'Too many attempts. Please wait a moment and try again.';
    }
    return error.message || 'Something went wrong. Please try again.';
  }
</script>
</body>
</html>
